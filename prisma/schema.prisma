generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Supplier {
  id             String  @id @default(uuid())
  name           String
  contactDetails String?
  deals          Deal[]
}

model Customer {
  id             String  @id @default(uuid())
  name           String
  contactDetails String?
  defaultTerms   String?
  deals          Deal[]
}

model Financier {
  id           String  @id @default(uuid())
  name         String
  fundingTerms String?
  deals        Deal[]
}

model Commodity {
  id    String @id @default(uuid())
  name  String @unique
  deals Deal[]
}

model Deal {
  id                       String     @id
  date                     DateTime
  status                   String     @default("Open")
  commodityId              String
  commodityGrade           String?
  supplierId               String
  customerId               String
  financierId              String?
  quantity                 Decimal
  supplierPricePerTon      Decimal
  offtakePricePerTon       Decimal
  costValue                Decimal
  expectedSalesValue       Decimal
  expectedGrossMargin      Decimal
  expectedMarginPercentage Decimal
  paymentTermsCustomer     Int?
  paymentTermsFinancier    Int?
  dealOwner                String?
  comments                 String?
  createdAt                DateTime   @default(now())
  updatedAt                DateTime   @updatedAt
  commodity                Commodity  @relation(fields: [commodityId], references: [id])
  customer                 Customer   @relation(fields: [customerId], references: [id])
  financier                Financier? @relation(fields: [financierId], references: [id])
  supplier                 Supplier   @relation(fields: [supplierId], references: [id])
  deliveries               Delivery[]
  loan                     Loan?
}

model Loan {
  id               String      @id @default(uuid())
  dealId           String      @unique
  principal        Decimal
  disbursementDate DateTime
  maturityDate     DateTime
  paymentTerms     Int
  repaymentAmount  Decimal
  status           String      @default("Open")
  deal             Deal        @relation(fields: [dealId], references: [id])
  repayments       Repayment[]
}

model Repayment {
  id     String   @id @default(uuid())
  loanId String
  date   DateTime
  amount Decimal
  method String
  loan   Loan     @relation(fields: [loanId], references: [id])
}

model Delivery {
  id            String            @id @default(uuid())
  dealId        String
  date          DateTime
  quantity      Float
  invoiceNumber String
  invoiceAmount Decimal
  status        String            @default("Unpaid")
  payments      CustomerPayment[]
  deal          Deal              @relation(fields: [dealId], references: [id])
}

model CustomerPayment {
  id         String   @id @default(uuid())
  deliveryId String
  date       DateTime
  amount     Decimal
  method     String
  delivery   Delivery @relation(fields: [deliveryId], references: [id])
}

model CashBook {
  id          String   @id @default(uuid())
  date        DateTime
  description String
  dealId      String?
  category    String
  cashIn      Decimal  @default(0)
  cashOut     Decimal  @default(0)
  bankIn      Decimal  @default(0)
  bankOut     Decimal  @default(0)
  createdAt   DateTime @default(now())
}

model User {
  id       String @id @default(uuid())
  email    String @unique
  password String
  name     String?
  role     String @default("USER")
}
